<!DOCTYPE html>
<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script src="js/gyro.js"></script>
    <script>
        var nombre;
        $(document).ready(function(){

            $("#btn1").click(function(){
                $.ajax({
                    url: "../new"
                })
                        .done(function( data ) {
                            nombre = data;
                            $( "#identificador" ).text(data);
                        })
                        .fail(function(){
                            $( "#identificador" ).text("error");
                        });
                var currentMousePos = { x: -1, y: -1 };
                setInterval(function(){

                    $(document).mousemove(function(event) {
                        currentMousePos.x = event.pageX;
                        currentMousePos.y = event.pageY;
                    });
                    var mouse= JSON.parse('{ "mouse" :' + JSON.stringify(currentMousePos) + '}');
                    $.ajax({
                        url: "../post/"+nombre,
                        data: mouse,
                        type: "POST"
                    })
                            .done(function( data ) {
                                $("#contador").text( "\n"+(JSON.stringify(mouse,undefined,4)))
                            })
                            .fail(function(){
                                $( "#contador" ).text("error");
                            });
                },1000)
            });

        });
    </script>
</head>
<body>

<p>ID: <strong id="identificador"> - </strong></p>
<pre><code class="html"><p>Counter: <strong id="contador"> - </strong></p></code></pre>

<button id="btn1">Conectar</button>

</body>
</html>
